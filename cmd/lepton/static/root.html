<html>
<head>
  <title>go-lepton</title>
  <style>
    .errorMsg {
      color: red;
    }
    .info {
      white-space: pre-wrap;
    }
    .mainImg {
      border: 1px solid #000000;
    }
  </style>
  <script>
    function onload() {
      var can = document.getElementById("canvas1");
      var context = can.getContext("2d");
      var image = document.createElement("img");
      var errorMsg = document.getElementById("errorMsg");
      var info = document.getElementById("info");

      var socket = new WebSocket(websocketURL("/stream"));
      socket.addEventListener("message", function(event) {
        var hdr = event.data[0];
        var msg = event.data.slice(1);
        if (hdr == "I") {
          image.src = 'data:image/png;base64,' + msg;
          context.drawImage(image, 0, 0, 800, 600);
        } else if (hdr == "M") {
          var data = JSON.parse(msg);
          var str = JSON.stringify(data, null, 2);
          info.innerText = str;
        }
      });
      socket.addEventListener("error", function(event) {
        errorMsg.innerText = "Websocket error" + event;
      });
      socket.addEventListener("close", function(event) {
        errorMsg.innerText = "Websocket closed";
      });
    }

    function websocketURL(s) {
      var l = window.location;
      return ((l.protocol === "https:") ? "wss://" : "ws://") + l.hostname + ":" + l.port + s;
    }
  </script>
</head>
<body onload="onload()">
  <div id="errorMsg" class="errorMsg"></div><br>
  <canvas id="canvas1" class="mainImg" width="800" height="600"></canvas>
  <br>
  <div id="info" class="info">Infos</div>
</body>
</html>
