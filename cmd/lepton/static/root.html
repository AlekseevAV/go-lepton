<html>
<head>
  <title>go-lepton</title>
  <style>
    .errorMsg {
      color: red;
    }
    .mainImg {
      border: 1px solid #000000;
    }
  </style>
  <script>
    function onload() {
      var can = document.getElementById("canvas1");
      var context = can.getContext("2d");
      var image = document.createElement("img");

      var socket = new WebSocket(websocketURL("/stream"));
      socket.addEventListener("message", function(event) {
        // Packets are PNGs.
        image.src = 'data:image/png;base64,' + event.data;
        context.drawImage(image, 0, 0, 800, 600);
      });
      socket.addEventListener("error", function(event) {
        var d = document.getElementById("errorMsg");
        d.innerText = "Websocket error" + event;
      });
      socket.addEventListener("close", function(event) {
        var d = document.getElementById("errorMsg");
        d.innerText = "Websocket closed";
      });
    }

    function websocketURL(s) {
      var l = window.location;
      return ((l.protocol === "https:") ? "wss://" : "ws://") + l.hostname + ":" + l.port + s;
    }
  </script>
</head>
<body onload="onload()">
  <div id="errorMsg" class="errorMsg"></div>
  <canvas id="canvas1" class="mainImg" width="800" height="600"></canvas>
</body>
</html>
